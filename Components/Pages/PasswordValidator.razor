@page "/password-validator"
@rendermode InteractiveServer
@using PasswordValidatorSolution.Services
@inject IValidationService ValidationService
@using System.Collections.Generic
@using System.Text.RegularExpressions

<PageTitle>Password Validator</PageTitle>

<h1>Password Strength Checker</h1>

<p>Enter a password below—it'll check strength live (min 8 chars, 1 number, 1 uppercase).</p>

<div class="field">
    <label for="passwordInput" class="label">Password:</label>
    <div class="control">
        <input type="password" id="passwordInput" class="input" @bind="password" @oninput="ValidatePassword" placeholder="Type here..." />
    </div>
</div>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="notification is-danger">
        <button class="delete"></button>  <!-- Close button for style -->
        <strong>Whoops!</strong> @errorMessage
    </div>
}
else if (!string.IsNullOrEmpty(password) && isStrong)
{
    <div class="notification is-success">
        <button class="delete"></button>
        <strong>Nice!</strong> Password is strong—ready to roll.
    </div>
}

@code {
    private string password = string.Empty;
    private string errorMessage = string.Empty;
    private bool isStrong = false;

    private void ValidatePassword(ChangeEventArgs e)
    {
        password = e.Value?.ToString() ?? string.Empty;
        errorMessage = string.Empty;
        isStrong = false;

        if (string.IsNullOrEmpty(password))
            return;  // No need to check empty

        if (ValidationService.IsPasswordStrong(password))
        {
            isStrong = true;
            return;
        }

        // Build error list (matches service checks)
        var errors = new List<string>();
        if (password.Length < 8)
            errors.Add("Must be at least 8 characters.");
        if (!Regex.IsMatch(password, @"[0-9]"))
            errors.Add("Needs at least one number.");
        if (!Regex.IsMatch(password, @"[A-Z]"))
            errors.Add("Needs at least one uppercase letter.");

        errorMessage = string.Join(" | ", errors);
    }
}